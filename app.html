<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holostats Spielerstatistik-Suche</title>
    <style>
        /* === Allgemeiner Stil und Dunkles Thema === */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1e1e1e; /* Dunkler Hintergrund */
            color: #f0f0f0; /* Helle Textfarbe */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 50px;
        }
        .container {
            display: none; /* NEU: Standardmäßig versteckt */
            width: 90%;
            max-width: 700px;
            background: #2d2d30; /* Dunkle Container-Fläche */
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        h1 {
            color: #4CAF50; /* Akzentfarbe Grün */
            text-align: center;
            margin-bottom: 5px;
            font-size: 2em;
        }
        #current-date {
            text-align: right;
            font-size: 0.8em;
            color: #aaa;
            margin-bottom: 25px;
            border-bottom: 1px solid #3a3a3d;
            padding-bottom: 10px;
        }
        
        /* === LOGIN MODAL STYLES (NEU) === */
        #login-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1e1e1e; /* Hintergrundfarbe des Bodys */
            display: none; /* Wird über JS bei Bedarf auf 'flex' gesetzt */
            justify-content: center;
            align-items: center;
            z-index: 101; /* Über allen anderen Elementen */
        }

        #login-form-container {
            background-color: #2d2d30;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            text-align: center;
            width: 90%;
            max-width: 350px;
        }

        #login-form-container h2 {
            color: #4CAF50;
            margin-top: 0;
            margin-bottom: 20px;
        }

        #login-form-container p {
            color: #aaa;
        }

        #login-username, #login-password {
            width: calc(100% - 30px);
            padding: 12px 15px;
            margin: 10px 0;
            border: 1px solid #555;
            border-radius: 6px;
            background-color: #3a3a3d;
            color: #f0f0f0;
            font-size: 1em;
            box-sizing: border-box;
        }
        #login-username:focus, #login-password:focus {
            border-color: #4CAF50;
            outline: none;
        }

        #login-form-container button {
            width: 100%;
            padding: 12px;
            margin-top: 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1.1em;
            transition: background-color 0.2s;
        }

        #login-form-container button:hover {
            background-color: #43A047;
        }
        
        /* === Suchfeld-Design (Suchfenster) === */
        #search-container {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            position: relative;
        }
        #search-input {
            padding: 12px 15px;
            font-size: 1.1em;
            border: 2px solid #555;
            border-radius: 8px;
            flex-grow: 1;
            background-color: #3a3a3d;
            color: #f0f0f0;
            transition: border-color 0.3s;
        }
        #search-input:focus {
            border-color: #4CAF50; /* Akzentfarbe bei Fokus */
            outline: none;
        }
        #search-button {
            padding: 12px 20px;
            font-size: 1.1em;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #search-button:hover {
            background-color: #43A047;
        }
        
        /* === Vorschlags-Container (Top 5 & Dynamisch) === */
        #suggestions-container, #dynamic-suggestions-container {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            background-color: #3a3a3d;
            border-left: 5px solid #4CAF50; /* Grüner Akzent */
        }
        #suggestions-container h4, #dynamic-suggestions-container h4 {
            margin-top: 0;
            color: #4CAF50; 
            margin-bottom: 10px;
            font-size: 1em;
        }
        .suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .suggestion-player {
            background-color: #555;
            color: #fff;
            padding: 7px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            font-weight: bold;
        }
        .suggestion-player:hover {
            background-color: #4CAF50;
            transform: translateY(-2px);
        }

        /* === Ergebnis-Karten === */
        #results-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
        }
        .player-card {
            border: 1px solid #444;
            padding: 15px;
            border-radius: 8px;
            width: 160px;
            text-align: center;
            background: #3a3a3d;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer; 
        }
        .player-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.5), 0 0 10px #4CAF50;
        }
        .player-card img {
            width: 64px;
            height: 64px;
            border-radius: 50%; /* Rundes Profilbild */
            border: 3px solid #4CAF50;
            margin-bottom: 10px;
            image-rendering: pixelated;
        }
        .player-card h3 {
            margin: 0 0 8px 0;
            font-size: 1.2em;
            color: #e0e0e0;
            word-break: break-all;
        }
        .player-card p {
            margin: 0;
            font-size: 0.95em;
            color: #bbb;
        }
        .divider {
            margin: 10px 0;
            border-top: 1px solid #444;
        }
        
        /* === Meldungen und Fehler === */
        #error-message {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            border-radius: 6px;
            font-weight: bold;
            display: none; /* Initial versteckt */
        }
        /* Erfolgsmeldung */
        #error-message[style*="background-color: #d4edda"] { 
            background-color: #384239 !important;
            border: 1px solid #4CAF50;
            color: #4CAF50 !important;
        }
        /* Fehlermeldung */
        #error-message[style*="background-color: #f2dede"] { 
            background-color: #5d3f42 !important;
            border: 1px solid #d9534f;
            color: #d9534f !important;
        }

        /* === DETAIL MODAL STYLES === */
        .modal {
            display: none; 
            position: fixed;
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%; 
            height: 100%; 
            overflow: auto; 
            background-color: rgba(0,0,0,0.8); 
        }
        .modal-content {
            background-color: #3a3a3d;
            margin: 10% auto;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 450px;
            position: relative;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
        }
        .close-button {
            color: #aaa;
            float: right;
            font-size: 30px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover,
        .close-button:focus {
            color: #fff;
        }
        #detail-content img {
            width: 128px; 
            height: auto;
            image-rendering: pixelated;
            margin: 15px auto 25px auto;
            border: 4px solid #4CAF50;
            border-radius: 50%;
        }
        #detail-content h2 {
            color: #4CAF50;
            margin-top: 0;
            border-bottom: 1px solid #444;
            padding-bottom: 15px;
            font-size: 1.8em;
        }
        #detail-content p {
            margin: 12px 0;
            text-align: left;
            padding: 5px 10px;
            font-size: 1.05em;
            background-color: #2d2d30;
            border-radius: 4px;
        }
        #detail-content b {
            color: #fff;
        }
        #detail-content a {
            display: block;
            margin-top: 25px;
            padding: 12px;
            background-color: #007bff; /* Sekundäre Akzentfarbe Blau */
            color: white;
            text-decoration: none;
            border-radius: 6px;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        #detail-content a:hover {
            background-color: #0056b3;
        }
    </style>
</head>
<body>

<div id="login-modal-overlay">
    <div id="login-form-container">
        <h2>Zugriff erforderlich</h2>
        <p>Bitte melden Sie sich an, um die Holostats-Daten einzusehen.</p>
        <input type="text" id="login-username" placeholder="Benutzername">
        <input type="password" id="login-password" placeholder="Passwort" onkeyup="if(event.key === 'Enter') checkLogin()">
        <button onclick="checkLogin()">Anmelden</button>
        <p id="login-message" style="color: #d9534f; margin-top: 10px; display: none;"></p>
    </div>
</div>
<div class="container">
    <h1><span style="color: white;">Sunny_Casino</span> - Spieler Umsatz suchen</h1>
    
    <p id="current-date">Daten-Stand: 07.12.2025</p>

    <div id="search-container">
        <input type="text" id="search-input" placeholder="Spielernamen eingeben..." onkeyup="handleSearchInput(event)">
        <button id="search-button" onclick="searchPlayers(true)">Suchen</button>
    </div>
    
    <div id="dynamic-suggestions-container" style="display: none;">
        </div>

    <div id="suggestions-container">
        </div>

    <p id="error-message"></p>

    
    
    <div id="results-container">
        </div>
</div>

<div id="admin-panel" style="
    display:none;
    position:fixed;
    top:0; right:0;
    background:#2d2d30;
    color:#fff;
    padding:15px;
    border-radius:0 0 0 10px;
    box-shadow:0 0 10px rgba(0,0,0,0.4);
    z-index:200;
">
    <h3 style="margin-top:0;color:#4CAF50;">Mod-Anfragen</h3>
    <div id="admin-requests"></div>
</div>


<div id="player-detail-modal" class="modal">
    <div class="modal-content">
        <span class="close-button" onclick="closePlayerDetails()">&times;</span>
        <div id="detail-content">
            </div>
    </div>
</div>

<script>

    const role = sessionStorage.getItem('holostats_role');
const loggedUser = sessionStorage.getItem('holostats_user');

// Wenn keine Rolle / kein Login → zurück zur Login-Seite
if (!role) {
    window.location.href = "index.html";
}

    
    // ** START DER NEUESTEN SPIELERDATEN **
    let playerStats = [
    {
      "uuid": "2143da9f-503b-4e4a-835a-d1d7f37a0af1",
      "playername": "JasonNewAcc",
      "wager": 4904301
    },
    {
      "uuid": "3afc41d9-6ac7-41d1-b7c2-8286ce21765d",
      "playername": "xNotNamex",
      "wager": 7864090
    },
    {
      "uuid": "895d190d-77d7-4c85-b79b-bcd6768011ca",
      "playername": "Lilly_197",
      "wager": 3022045
    },
    {
      "uuid": "1038f0a9-4431-490a-b07c-c3b5222b259c",
      "playername": "3infach_Craz7",
      "wager": 9644035
    },
    {
      "uuid": "2e809eab-3e83-4632-9743-d061c119b59f",
      "playername": "Yxlukas",
      "wager": 13346075
    },
    {
      "uuid": "467e9ab0-b048-4307-b5fd-1ea110f45817",
      "playername": "lblenni",
      "wager": 256010
    },
    {
      "uuid": "a490eea8-725d-4140-9ac7-68bd751229de",
      "playername": "1real_nox",
      "wager": 1244210
    },
    {
      "uuid": "9c1e2e4e-650b-4018-a22d-6197eca0a49f",
      "playername": "1Verfehlter",
      "wager": 1596185
    },
    {
      "uuid": "9d593273-a33d-40de-9e66-78ff12991e7e",
      "playername": "ces_cot",
      "wager": 65
    },
    {
      "uuid": "9bda69ad-3ebe-42e2-a48f-96fa6f3a4351",
      "playername": "KenRyugujiYT",
      "wager": 5
    },
    {
      "uuid": "42b0dfc2-40d9-44d3-8678-5091f15afde7",
      "playername": "BiBo_Th3_Ripp3r",
      "wager": 1660235
    },
    {
      "uuid": "f2ed72bb-31ef-42c3-8456-372c85aa739b",
      "playername": "Orb_Store",
      "wager": 5
    },
    {
      "uuid": "52ffcd1b-7cb4-48e7-82de-03a41afa061d",
      "playername": "pusplocke",
      "wager": 1962145
    },
    {
      "uuid": "77706451-4eaa-4061-9e03-169e27cee023",
      "playername": "Oxication_HD",
      "wager": 2432015
    },
    {
      "uuid": "fe10c7c9-83f4-4603-a423-d5cdcd1f2def",
      "playername": "RiryC001",
      "wager": 5
    },
    {
      "uuid": "068ff8c2-9918-411d-9593-d2b7e2fd371d",
      "playername": "Jere0258",
      "wager": 20010
    },
    {
      "uuid": "0e7c2bab-cf1b-4d3c-954f-e2a11cd0b582",
      "playername": "zNight649",
      "wager": 83098080
    },
    {
      "uuid": "cab5bcd2-7b88-4a1d-94ba-dbaffc1a56f2",
      "playername": "xAlserak",
      "wager": 15128155
    },
    {
      "uuid": "a39d4373-60ad-4e18-852b-e0796dedef62",
      "playername": "Premium_man_",
      "wager": 5248075
    },
    {
      "uuid": "7e9774da-dd78-3fde-bbbb-61b84a5c979d",
      "playername": "!RobLoxxGhosT",
      "wager": 2352020
    },
    {
      "uuid": "3a5309af-6510-4445-916a-660aaeb0e76e",
      "playername": "Lattenrost1234",
      "wager": 12608075
    },
    {
      "uuid": "27c8b333-4954-32d7-a27c-12e4c61b58da",
      "playername": "!Russivan639",
      "wager": 920015
    },
    {
      "uuid": "d2362403-231e-4d2e-b26c-0ad7a8a24b80",
      "playername": "FriksGames",
      "wager": 17848320
    },
    {
      "uuid": "8dca34b2-9500-4d01-a510-a53037f20579",
      "playername": "Oxiiiii_42",
      "wager": 10
    },
    {
      "uuid": "21b987f7-2e45-4417-823c-2a9922635047",
      "playername": "1Kxksen",
      "wager": 2005
    },
    {
      "uuid": "75f31271-ea69-4ad4-b275-884dedb6d357",
      "playername": "salina3534",
      "wager": 9514055
    },
    {
      "uuid": "a380117b-7213-44b8-bb8d-1e0d3071aa19",
      "playername": "ItzZ_PauleXx",
      "wager": 104035
    },
    {
      "uuid": "440e3388-4cc4-4d7f-b5cd-048a5e9b8eea",
      "playername": "versabberter",
      "wager": 3426060
    },
    {
      "uuid": "79852977-c186-4c74-ba6a-186cec4c953a",
      "playername": "CryzZ11",
      "wager": 2246040
    },
    {
      "uuid": "7854f1fd-3050-41c7-99f4-60ad0d6eec25",
      "playername": "ItzZ_Popeye",
      "wager": 17858235
    },
    {
      "uuid": "5c2a3eee-ab92-4ff8-b71f-416c995ba97c",
      "playername": "zdobeq",
      "wager": 832170
    },
    {
      "uuid": "d0560923-c832-4c51-8053-d4869aef69ca",
      "playername": "RealShiva",
      "wager": 512005
    },
    {
      "uuid": "62a7ebe6-c142-42e7-b639-dc0d58236a2e",
      "playername": "Teufelswesen",
      "wager": 384000
    },
    {
      "uuid": "51597d23-214a-47a0-9fe6-2427e013efb8",
      "playername": "Trogoso",
      "wager": 8146085
    },
    {
      "uuid": "67da9ce1-b83d-49ae-9df6-146d26212f22",
      "playername": "Silberjason",
      "wager": 136040
    },
    {
      "uuid": "4a8fcd88-c3e0-4bc8-8e76-7cb825095c83",
      "playername": "meerkatinthehat",
      "wager": 20
    },
    {
      "uuid": "966f6fef-a5ce-3486-aa85-3e43f265336b",
      "playername": "!uzzi193159",
      "wager": 155
    },
    {
      "uuid": "e278048c-993f-4dda-adce-d29e93887aaa",
      "playername": "Null_FPS",
      "wager": 256015
    },
    {
      "uuid": "05a43700-011f-4ea5-b3b6-e7d189758271",
      "playername": "4real2k",
      "wager": 1664010
    },
    {
      "uuid": "6ec4de13-0deb-4b08-b0d1-1f27dbb9fff4",
      "playername": "Rxffel",
      "wager": 6025
    },
    {
      "uuid": "d774b1f9-5078-439a-a267-17d6a5b02f5d",
      "playername": "Telephos85",
      "wager": 3492015
    },
    {
      "uuid": "98bd03cf-ac4c-4bcc-82a4-19e74c7d7ea2",
      "playername": "Nectaner",
      "wager": 16010
    },
    {
      "uuid": "c1565fda-3110-4549-904b-8cd07d7a464a",
      "playername": "Agent007_",
      "wager": 38270
    },
    {
      "uuid": "7b097e9c-6269-4f4e-8cad-910bfa64a675",
      "playername": "DrInk3653",
      "wager": 3584005
    },
    {
      "uuid": "b1eeae81-97cc-4798-a908-9848cf35953d",
      "playername": "XZSupaA_Gecko",
      "wager": 5
    },
    {
      "uuid": "f460c89e-c955-456c-8d3a-fecae5fd6d88",
      "playername": "1Lxca",
      "wager": 130005
    },
    {
      "uuid": "bce9a4da-6993-4066-b4ac-51ea75b24092",
      "playername": "BoBderBaumester",
      "wager": 384005
    },
    {
      "uuid": "4be759a2-a416-4e35-b1d8-7b61deb6ccb1",
      "playername": "JustHackl",
      "wager": 5
    },
    {
      "uuid": "61a62498-35a3-4437-9746-7ce258e77464",
      "playername": "Lumania2020",
      "wager": 768000
    },
    {
      "uuid": "63a2f0d3-70a5-4c4f-a609-ada33451c8d6",
      "playername": "zFlevo",
      "wager": 4000
    },
    {
      "uuid": "f04cc68f-cf1d-45d5-bf9c-0f2f1410d5da",
      "playername": "mayumyi",
      "wager": 256000
    },
    {
      "uuid": "02b57fac-b8be-4693-90ca-50be497b7945",
      "playername": "9Sleepyy",
      "wager": 11278170
    },
    {
      "uuid": "8dc50d76-b7cc-406e-8ecf-01bbfb45f4e1",
      "playername": "LytnoGG",
      "wager": 192060
    },
    {
      "uuid": "1478210a-6b94-4486-bb9b-bfc8c1a786db",
      "playername": "Crazylaser46",
      "wager": 490090
    },
    {
      "uuid": "33510a1b-0aff-4cd5-8f8a-62dfdce109c7",
      "playername": "Stepmarvin_",
      "wager": 1542010
    },
    {
      "uuid": "b85224c9-60bb-4d5b-8623-a778176c6b59",
      "playername": "KurzVorGucci",
      "wager": 128005
    },
    {
      "uuid": "4da4007c-d36e-4e51-85e3-b9032fc3a158",
      "playername": "Alterschwede45",
      "wager": 640255
    },
    {
      "uuid": "b0d05b0a-1433-4f09-82ae-45e7a95d2a16",
      "playername": "ReLaXeD_YT",
      "wager": 1024000
    },
    {
      "uuid": "9ce71af3-f8be-4d98-a1ee-84f2e969729e",
      "playername": "Farfuss293",
      "wager": 9350115
    },
    {
      "uuid": "9a630acf-e2a8-4851-b427-35830297878e",
      "playername": "OkBinStili",
      "wager": 876035
    },
    {
      "uuid": "e0233016-36a8-40ad-a9d4-9b3c9acc47b4",
      "playername": "xJazeek",
      "wager": 16135
    },
    {
      "uuid": "f06b9822-5c24-4a0b-8a57-4dcd5640e256",
      "playername": "UndeadDuck",
      "wager": 128000
    },
    {
      "uuid": "983b1a4a-9f5d-4e76-8fb3-ee3459066851",
      "playername": "Em1n3e7",
      "wager": 64005
    },
    {
      "uuid": "0b12bb65-2f18-408a-a004-87e756bdb83e",
      "playername": "Verhunted",
      "wager": 130005
    },
    {
      "uuid": "b4e86782-c1b5-4fbe-8e37-24410ddb49d2",
      "playername": "Luksch007x",
      "wager": 11008000
    },
    {
      "uuid": "15fef32b-8f3b-457d-a005-adb89baa490c",
      "playername": "IchGehOOC",
      "wager": 512055
    },
    {
      "uuid": "1eabc4cd-f6de-4038-b67b-9b0aa0840247",
      "playername": "mcpack22",
      "wager": 5
    },
    {
      "uuid": "b05acf76-7fc9-43d2-a16b-12e78a4d4bd1",
      "playername": "Gaming__Buddy",
      "wager": 15
    },
    {
      "uuid": "687102df-08c8-47fe-8771-1bb03ebfdb8e",
      "playername": "Amelie1up",
      "wager": 128090
    },
    {
      "uuid": "10dd715e-c489-400d-8024-5f5440840685",
      "playername": "Marcel1UP",
      "wager": 384120
    },
    {
      "uuid": "56ed648d-9fa2-4027-93e4-32c6e87c1967",
      "playername": "NiemandKilltMich",
      "wager": 18602010
    },
    {
      "uuid": "0869cafa-4ceb-47ac-93ac-20993c9a02c9",
      "playername": "BerndDasBrot2",
      "wager": 1512030
    },
    {
      "uuid": "0b94f4e3-2f1a-45ad-9ea1-d2b83e881783",
      "playername": "yasin112",
      "wager": 2005
    },
    {
      "uuid": "affd6ad8-58c3-4e93-be9f-d4ba32fdebfa",
      "playername": "NightWolfLG",
      "wager": 256005
    },
    {
      "uuid": "19c19880-6b67-49bc-b691-c24c6c3ab97f",
      "playername": "DerTechnoGod",
      "wager": 64040
    },
    {
      "uuid": "fd9ba1a8-5bc1-47b2-871c-974c105f31db",
      "playername": "ItsEmily17",
      "wager": 10
    },
    {
      "uuid": "c1cc9cbc-5458-43f3-87a0-b9c3c369e931",
      "playername": "Emilian141",
      "wager": 1370225
    },
    {
      "uuid": "9e65449f-1036-4c0d-8c55-82bef3bc70f7",
      "playername": "AceStarling9506",
      "wager": 25
    },
    {
      "uuid": "2821a07e-6619-4938-b108-4d1300b9c497",
      "playername": "dcue",
      "wager": 3072010
    },
    {
      "uuid": "be35c47b-7970-49a3-8a97-f29016238e64",
      "playername": "Schlagzeugnis",
      "wager": 1792005
    },
    {
      "uuid": "1fccf772-0ffe-4de5-bae9-e002177f1a47",
      "playername": "nxmooo",
      "wager": 1088000
    },
    {
      "uuid": "eb6b414c-e708-4761-a6e0-7c251cc76b77",
      "playername": "Krebserreger2",
      "wager": 814140
    },
    {
      "uuid": "74725752-2df1-4c61-b2b0-636473ba344d",
      "playername": "Noel2811",
      "wager": 8146015
    }
    ]; // HINZUGEFÜGT: Schließende Klammer für das Array und der letzte Spieler ohne Komma.
    
    // Die restlichen Skript-Funktionen folgen unverändert
    const PLAYER_STATS_FILE = 'player_stats_latest.json';
    const ACCOUNTS_FILE = 'accounts.json';
    const LOGIN_KEY = 'isLoggedIn';
    let validAccounts = [];
    let accountsLoaded = false;
    let topPlayers = [];

    // --- HILFSFUNKTIONEN (FUNKTIONAL) ---

    /**
     * Gibt den bereinigten Spielernamen für die Skin-URL-Generierung zurück.
     * @param {string} playerName Der Roh-Spielername.
     * @returns {string} Der bereinigte Spielername.
     */
    function cleanPlayerNameForSkin(playerName) {
        // Entfernt führende "!" (wie "!RobLoxxGhosT")
        // Und entfernt abschließende "..." (falls vorhanden)
        return playerName.replace(/^!/, '').replace(/\.\.\.$/, '');
    }

    /**
     * Holt die Top 5 Spieler (höchster Umsatz).
     * @returns {Array<Object>} Die Top 5 Spieler.
     */
    function getTop5Players() {
        return playerStats
            .slice() // Kopie erstellen, um das Original nicht zu ändern
            .sort((a, b) => b.wager - a.wager)
            .slice(0, 5);
    }

    /**
     * Zeigt die Top 5 Spieler als Vorschläge an.
     */
    function displayTopSuggestions() {
        const container = document.getElementById('suggestions-container');
        const dynamicContainer = document.getElementById('dynamic-suggestions-container');
        container.style.display = 'block';
        dynamicContainer.style.display = 'none';
        
        // Sortieren und Top 5 holen (nur einmalig, dann cachen)
        if (topPlayers.length === 0) {
            topPlayers = getTop5Players();
        }
        
        container.innerHTML = `<h4>Top 5 Spieler nach Umsatz (Klicken zum Suchen)</h4><div class="suggestion-list"></div>`;
        const list = container.querySelector('.suggestion-list');
        
        topPlayers.forEach(player => {
            const span = document.createElement('span');
            span.className = 'suggestion-player';
            span.textContent = player.playername;
            span.onclick = () => setInputAndSearch(player.playername);
            list.appendChild(span);
        });
    }

    /**
     * Zeigt dynamische Vorschläge basierend auf der aktuellen Sucheingabe an.
     * @param {string} searchTerm Der Suchbegriff (kleingeschrieben).
     */
    function displayDynamicSuggestions(searchTerm) {
        const dynamicContainer = document.getElementById('dynamic-suggestions-container');
        
        if (searchTerm.length < 2) {
            dynamicContainer.style.display = 'none';
            displayTopSuggestions();
            return;
        }

        // Exakter Match zuerst
        let exactMatch = playerStats.find(p => p.playername.toLowerCase() === searchTerm);
        
        // Ähnliche Matches (enthält den Suchbegriff)
        let similarPlayers = playerStats.filter(p => 
            p.playername.toLowerCase().includes(searchTerm) && 
            p.playername.toLowerCase() !== searchTerm // Exakten Match ausschließen
        ).sort((a, b) => {
            // Sortiere: Startet mit Suchbegriff vor nur enthalten (Heuristik)
            const aStarts = a.playername.toLowerCase().startsWith(searchTerm);
            const bStarts = b.playername.toLowerCase().startsWith(searchTerm);
            if (aStarts && !bStarts) return -1;
            if (!aStarts && bStarts) return 1;
            return b.wager - a.wager; // Ansonsten nach Umsatz
        }).slice(0, 4); // Maximal 4 zusätzliche Vorschläge
        
        if (exactMatch || similarPlayers.length > 0) {
            dynamicContainer.style.display = 'block';
            dynamicContainer.innerHTML = '<h4>Ähnliche Spielernamen (Klicken zum Suchen)</h4><div class="suggestion-list"></div>';
            const list = dynamicContainer.querySelector('.suggestion-list');
            
            // Exakter Match zuerst anzeigen (wenn er nicht schon gesucht wurde)
            if (exactMatch) {
                const span = document.createElement('span');
                span.className = 'suggestion-player';
                span.textContent = exactMatch.playername + " (Exakt)";
                span.style.backgroundColor = '#4CAF50';
                span.onclick = () => setInputAndSearch(exactMatch.playername);
                list.appendChild(span);
            }
            
            // Dann ähnliche Spieler
            similarPlayers.forEach(player => {
                const span = document.createElement('span');
                span.className = 'suggestion-player';
                span.textContent = player.playername;
                span.onclick = () => setInputAndSearch(player.playername);
                list.appendChild(span);
            });
            document.getElementById('suggestions-container').style.display = 'none';
        } else {
            dynamicContainer.style.display = 'none';
            displayTopSuggestions(); // Zeige Top 5, wenn keine dynamischen Treffer
        }
    }

    // --- SUCHE UND DETAILS ---

    /**
     * Setzt den Suchwert und startet die Suche. Wird von den Vorschlägen genutzt.
     */
    function setInputAndSearch(playerName) {
        document.getElementById('search-input').value = playerName;
        searchPlayers(true);
        playClickSound() // Sound beim Klicken auf Vorschlag
    }

    /**
     * Behandelt Tastatureingaben im Suchfeld.
     */
    function handleSearchInput(event) {
        const input = document.getElementById('search-input');
        const searchTerm = input.value.toLowerCase().trim();
        if (event && event.type === 'keyup') {
            if (event.key === 'Enter') {
                searchPlayers(true);
            } else {
                // Bei jeder anderen Eingabe: zeige dynamische Vorschläge
                document.getElementById('results-container').innerHTML = '';
                document.getElementById('error-message').style.display = 'none';
                displayDynamicSuggestions(searchTerm);
            }
        }
    }

    /**
     * Sucht nach Spielern basierend auf der Eingabe (exakter Match oder Teilstring-Match).
     */
    function searchPlayers(isFullSearch = false) {
        const input = document.getElementById('search-input');
        const searchTerm = input.value.toLowerCase().trim();
        const resultsContainer = document.getElementById('results-container');
        resultsContainer.innerHTML = ''; // Vorherige Ergebnisse löschen
        document.getElementById('error-message').style.display = 'none';
        document.getElementById('dynamic-suggestions-container').style.display = 'none';
        document.getElementById('suggestions-container').style.display = 'none';
        
        if (searchTerm === "") {
            displayTopSuggestions();
            return;
        }
        
        // --- MODERATOR FUNKTIONALITÄT (NEU) ---
        // Wenn die Rolle Moderator ist und der gesuchte Begriff ein UUID ist, ist eine Freigabe erforderlich.
        if (role === "moderator" && isUUID(searchTerm)) {
            displayMessage("Bitte keine UUIDs direkt suchen. Beantrage die Freigabe des Benutzers über den 'Anfrage senden' Button.", 'error');
            return;
        }
        
        // Moderator: Bei der Suche nach einem Namen muss dieser auch erst freigegeben werden.
        if (role === "moderator" && isFullSearch) {
            sendModeratorRequest(searchTerm);
            return;
        }
        // --- ENDE MODERATOR FUNKTIONALITÄT ---

        // 1. Exakter Match (Case-Insensitive)
        let foundPlayers = playerStats.filter(p => p.playername.toLowerCase() === searchTerm);

        // 2. Teilstring-Match (nur bei Vollsuche)
        if (foundPlayers.length === 0 && isFullSearch) {
            foundPlayers = playerStats.filter(p => p.playername.toLowerCase().includes(searchTerm));
        }

        if (foundPlayers.length > 0) {
            foundPlayers
                .sort((a, b) => b.wager - a.wager) // Sortieren nach Umsatz (höchster zuerst)
                .forEach(player => createPlayerCard(player, resultsContainer));
            displayMessage(`${foundPlayers.length} Spieler gefunden!`, 'success');
            playClickSound();
        } else {
            // Wenn nichts gefunden wird, zeige Suchvorschläge
            displayDynamicSuggestions(searchTerm);
            displayMessage("Keine Spieler gefunden. Bitte verfeinere deine Suche.", 'error');
        }
    }

    /**
     * Zeigt die Detail-Modalbox für einen Spieler an.
     * @param {string} playerName Der Name des Spielers.
     */
    function showPlayerDetails(playerName) {
        const player = playerStats.find(p => p.playername === playerName);
        const modal = document.getElementById('player-detail-modal');
        const content = document.getElementById('detail-content');
        
        if (!player) {
            displayMessage(`Fehler: Spieler ${playerName} nicht gefunden.`, 'error');
            return;
        }
        
        const cleanName = cleanPlayerNameForSkin(player.playername);
        const skinUrl = `https://mineskin.eu/helm/${cleanName}/128`;
        
        content.innerHTML = `
            <img src="${skinUrl}" alt="Skin von ${player.playername}">
            <h2>${player.playername}</h2>
            <p><b>UUID:</b> ${player.uuid}</p>
            <p><b>Gesamt-Umsatz:</b> ${formatNumber(player.wager)} €</p>
            <p><b>Link zu Namemc:</b> <a href="https://namemc.com/profile/${cleanName}" target="_blank">Profil ansehen</a></p>
        `;

        modal.style.display = 'block';
    }

    // --- MODERATOR FUNKTIONEN (NEU) ---

    /**
     * Prüft, ob ein String ein gültiger UUID ist.
     * @param {string} str Der zu prüfende String.
     * @returns {boolean} True, wenn es ein UUID ist.
     */
    function isUUID(str) {
        // Einfache Prüfung für die Zwecke dieser Anwendung
        return /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(str);
    }

    /**
     * Sendet eine Anfrage zur Freigabe eines Spielernamens an den Moderator.
     * @param {string} searchValue Der gesuchte Spielername.
     */
    function sendModeratorRequest(searchValue) {
        const reason = prompt(`Du bist im Moderator-Modus. Die Suche nach "${searchValue}" muss freigegeben werden. Bitte gib einen Grund für die Suche ein:`);
        
        if (reason === null || reason.trim() === "") {
            displayMessage("Anfrage abgebrochen. Es muss ein Grund angegeben werden.", 'error');
            return;
        }

        // Prüfen, ob eine offene Anfrage für diesen Benutzer und diesen Spieler bereits existiert
        let requests = JSON.parse(localStorage.getItem('moderator_requests') || "[]");
        const existing = requests.find(r => 
            r.user === loggedUser && 
            r.target.toLowerCase() === searchValue.toLowerCase() && 
            r.status === "pending"
        );

        if (existing) {
            displayMessage("Anfrage für diesen Spieler läuft bereits.", 'error');
            return;
        }
        
        // Anfrage speichern
        requests.push({
            user: loggedUser,
            target: searchValue,
            reason: reason,
            time: Date.now(),
            status: "pending"
        });
        localStorage.setItem('moderator_requests', JSON.stringify(requests));
        
        // Rückmeldung an den Benutzer
        document.getElementById("results-container").innerHTML = `<div style="text-align:center;">
            <img src="waiting-icon-gif-5.jpg" width="120"><br>
            <p style="margin-top:10px;font-size:1.2em;color:#4CAF50;">Anfrage gesendet. Warte auf Freigabe durch einen Admin.</p>
        </div>`;
    }

    /**
     * Lädt und zeigt die Admin-Anfragen im Admin-Panel an.
     */
    function loadAdminRequests() {
        if (role !== "admin") {
            document.getElementById('admin-panel').style.display = 'none';
            return;
        }
        document.getElementById('admin-panel').style.display = 'block';
        
        const requests = JSON.parse(localStorage.getItem('moderator_requests') || "[]").filter(r => r.status === "pending");
        const container = document.getElementById('admin-requests');
        container.innerHTML = requests.length === 0 
            ? '<p style="color:#aaa;">Keine offenen Anfragen.</p>' 
            : '';

        requests.forEach((req, index) => {
            const div = document.createElement('div');
            div.style.marginBottom = '15px';
            div.style.padding = '10px';
            div.style.border = '1px solid #4CAF50';
            div.style.borderRadius = '5px';
            div.innerHTML = `
                <p><strong>Von:</strong> ${req.user}</p>
                <p><strong>Ziel:</strong> ${req.target}</p>
                <p><strong>Grund:</strong> ${req.reason}</p>
                <p style="font-size:0.8em;color:#aaa;">${new Date(req.time).toLocaleString('de-DE')}</p>
                <button onclick="approveRequest(${index})" style="background-color:#4CAF50; color:white; border:none; padding:8px; margin-top:5px; cursor:pointer; border-radius:4px;">Freigeben</button>
                <button onclick="rejectRequest(${index})" style="background-color:#d9534f; color:white; border:none; padding:8px; margin-top:5px; cursor:pointer; border-radius:4px; margin-left:10px;">Ablehnen</button>
            `;
            container.appendChild(div);
        });
    }

    /**
     * Lehnt eine Moderator-Anfrage ab.
     * @param {number} index Der Index der Anfrage im gefilterten Array.
     */
    function rejectRequest(index) {
        let requests = JSON.parse(localStorage.getItem('moderator_requests') || "[]");
        // Finde die tatsächliche Anfrage (da wir mit einem gefilterten Array arbeiten)
        let pendingRequests = requests.filter(r => r.status === "pending");
        if (index >= 0 && index < pendingRequests.length) {
            const reqToReject = pendingRequests[index];
            // Finde den Index im Original-Array
            const originalIndex = requests.findIndex(r => r === reqToReject);
            if (originalIndex !== -1) {
                requests[originalIndex].status = "rejected";
                localStorage.setItem('moderator_requests', JSON.stringify(requests));
                alert("Anfrage abgelehnt.");
                loadAdminRequests();
            }
        }
    }

    /**
     * Gibt eine Moderator-Anfrage frei.
     * @param {number} index Der Index der Anfrage im gefilterten Array.
     */
    function approveRequest(index) {
        let requests = JSON.parse(localStorage.getItem('moderator_requests') || "[]");
        let pendingRequests = requests.filter(r => r.status === "pending");
        
        if (index >= 0 && index < pendingRequests.length) {
            const reqToApprove = pendingRequests[index];
            const originalIndex = requests.findIndex(r => r === reqToApprove);
            
            if (originalIndex !== -1) {
                requests[originalIndex].status = "approved";
                localStorage.setItem('moderator_requests', JSON.stringify(requests));
                alert("Anfrage freigegeben!");
                loadAdminRequests();
            }
        }
    }

    /**
     * Formatiert eine Zahl mit Tausender-Trennzeichen (deutsch).
     */
    function formatNumber(num) {
        return (typeof num === 'number' && !isNaN(num)) ? num.toLocaleString('de-DE') : 'N/A';
    }

    /**
     * Schließt das Detail-Modal.
     */
    function closePlayerDetails() {
        const modal = document.getElementById('player-detail-modal');
        modal.style.display = 'none';
        // Sound beim Schließen entfernt
    }

    /**
     * Zeigt eine Erfolgs- oder Fehlermeldung an.
     */
    function displayMessage(message, type = 'success') {
        const errorMessage = document.getElementById('error-message');
        errorMessage.textContent = message;
        errorMessage.style.display = 'block';
        if (type === 'success') {
            errorMessage.style.backgroundColor = '#384239'; // Dunkler für Erfolg
            errorMessage.style.color = '#4CAF50'; // Grüner Text
            errorMessage.style.border = '1px solid #4CAF50';
        } else {
            errorMessage.style.backgroundColor = '#5d3f42'; // Dunkler für Fehler
            errorMessage.style.color = '#d9534f'; // Roter Text
            errorMessage.style.border = '1px solid #d9534f';
        }
    }

    /**
     * Erstellt und zeigt eine Spielerkarte an.
     */
    function createPlayerCard(player, resultsContainer) {
        const card = document.createElement('div');
        card.className = 'player-card';
        card.onclick = () => {
            showPlayerDetails(player.playername);
            playClickSound(); // Sound beim Klicken auf Karte
        };

        // Bereinigter Name für die Skin-URL
        const cleanName = cleanPlayerNameForSkin(player.playername);

        // Skin URL für die Karte (Kopf)
        const skinUrl = `https://mineskin.eu/head/${cleanName}/64`;
        
        const img = document.createElement('img');
        img.src = skinUrl;
        img.alt = `Skin-Kopf von ${player.playername}`;

        const nameHeading = document.createElement('h3');
        nameHeading.textContent = player.playername;

        const divider = document.createElement('div');
        divider.className = 'divider';

        const wagerText = document.createElement('p');
        wagerText.innerHTML = `<b>Umsatz:</b> <br>${formatNumber(player.wager)}`;

        card.appendChild(img);
        card.appendChild(nameHeading);
        card.appendChild(divider);
        card.appendChild(wagerText);
        resultsContainer.appendChild(card);
    }

    // --- AUTHENTIFIZIERUNG UND INITIALISIERUNG ---

    // NEU: Konstanten für Authentifizierung
    const ACCOUNTS_FILE_URL = 'accounts.json';
    const LOGIN_STORAGE_KEY = 'holostats_login_status'; // NEU: Storage Key für Login-Status
    const USER_ROLE_KEY = 'holostats_role'; // NEU: Storage Key für Benutzerrolle
    const USER_NAME_KEY = 'holostats_user'; // NEU: Storage Key für Benutzernamen
    const CLICK_SOUND_URL = './buttonclick.mp3';

    let accountsData = null; // Cache für die geladenen Kontodaten
    const clickAudio = new Audio(CLICK_SOUND_URL);

    /**
     * Spielt den Klick-Sound ab (nur für Spieler-Elemente).
     */
    function playClickSound() {
        // Stellt sicher, dass der Sound immer von Anfang an spielt, auch wenn er schnell nacheinander geklickt wird
        clickAudio.currentTime = 0; 
        clickAudio.play().catch(e => console.log('Sound playback blocked: ', e)); 
    }

    /**
     * Lädt die Kontodaten asynchron.
     * @returns {Promise<boolean>} True bei Erfolg, False bei Fehler.
     */
    async function loadAccounts() {
        try {
            const response = await fetch(ACCOUNTS_FILE_URL);
            if (!response.ok) {
                displayMessage(`FEHLER: Konnte die Datei "${ACCOUNTS_FILE_URL}" (Status: ${response.status}) nicht laden. Stellen Sie sicher, dass die Seite über einen Webserver (http://) aufgerufen wird.`, 'error');
                return false;
            }
            accountsData = await response.json();
            return true;
        } catch (error) {
            console.error('Fehler beim Laden der Accounts:', error);
            displayMessage(`KRITISCHER FEHLER: Die Datei "${ACCOUNTS_FILE_URL}" ist fehlerhaft oder konnte nicht geladen werden. Prüfen Sie die JSON-Syntax.`, 'error');
            return false;
        }
    }

    /**
     * Führt die Login-Prüfung durch.
     */
    function checkLogin() {
        const usernameInput = document.getElementById('login-username').value;
        const passwordInput = document.getElementById('login-password').value;
        const loginMessage = document.getElementById('login-message');
        loginMessage.style.display = 'none';
        
        // Prüfung gegen die geladenen Accounts in der validAccounts-Liste
        const accountFound = accountsData.find(account => 
            account.username === usernameInput && 
            account.password === passwordInput
        );
        
        if (accountFound) {
            // Erfolg
            sessionStorage.setItem(LOGIN_STORAGE_KEY, 'true');
            sessionStorage.setItem(USER_ROLE_KEY, accountFound.role);
            sessionStorage.setItem(USER_NAME_KEY, accountFound.username);

            document.getElementById('login-modal-overlay').style.display = 'none';
            document.querySelector('.container').style.display = 'block'; // Zeige Hauptinhalt
            
            // Initialisiere die App nach erfolgreichem Login
            initializeApp();
        } else {
            // Fehler
            loginMessage.textContent = 'Fehler: Ungültiger Benutzername oder Passwort.';
            loginMessage.style.display = 'block';
        }
    }

    /**
     * Initialisiert die Anwendung nach dem Login.
     */
    function initializeApp() {
        displayTopSuggestions(); // Zeige sofort die Top 5 an
        loadAdminRequests(); // Lade Admin-Anfragen, falls Admin
        
        // NEU: Wenn Moderator, prüfe, ob es eine freigegebene Anfrage gibt
        const currentRole = sessionStorage.getItem(USER_ROLE_KEY);
        const currentUser = sessionStorage.getItem(USER_NAME_KEY);
        
        if (currentRole === "moderator") {
            const requests = JSON.parse(localStorage.getItem('moderator_requests') || "[]");
            const found = requests.find(r =>
                r.user === currentUser &&
                r.status === "approved"
            );
            
            if (found) {
                // Führe die Suche für die freigegebene Anfrage durch
                document.getElementById('search-input').value = found.target;
                searchPlayers(false); // Führe Suche durch (nicht FullSearch, da der Name bekannt ist)

                // Danach löschen, damit es nicht erneut angezeigt wird
                const indexToRemove = requests.findIndex(r => r.time === found.time);
                if (indexToRemove !== -1) {
                    requests.splice(indexToRemove, 1);
                    localStorage.setItem('moderator_requests', JSON.stringify(requests));
                }
            }
        }
    }


    /**
     * Startpunkt der Anwendung.
     */
    async function init() {
        // 1. Lade Accounts
        accountsLoaded = await loadAccounts();
        
        if (!accountsLoaded) {
            // Wenn Accounts nicht geladen werden konnten, das Login-Overlay anzeigen und warten
            document.getElementById('login-modal-overlay').style.display = 'flex';
            return;
        }

        // 2. Prüfen, ob bereits eingeloggt
        const isLoggedIn = sessionStorage.getItem(LOGIN_STORAGE_KEY) === 'true';
        const container = document.querySelector('.container');
        const loginOverlay = document.getElementById('login-modal-overlay');

        if (isLoggedIn) {
            // Bereits eingeloggt
            loginOverlay.style.display = 'none';
            container.style.display = 'block'; // Zeige Hauptinhalt
            initializeApp();
        } else {
            // Zeige Login-Overlay
            loginOverlay.style.display = 'flex';
            // Setze den Fokus auf das Eingabefeld
            document.getElementById('login-username').focus();
        }
    }

    // Starte die Anwendung
    init();
    </script>
</body>
</html>
